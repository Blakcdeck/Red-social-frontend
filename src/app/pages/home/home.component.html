
<div class="home-wrapper">
    <div class="feed-container">
        <h2>‚ú® Mi Red Social</h2>

        <div class="post-form">
            <!-- Header del acorde√≥n principal -->
            <div class="post-form-header" [class.expanded]="isPostFormExpanded" (click)="togglePostForm()">
                <span>üìù Crear nuevo post</span>
                <span class="accordion-icon">‚ñº</span>
            </div>

            <!-- Contenido del acorde√≥n principal -->
            <div class="post-form-content" [class.expanded]="isPostFormExpanded">
                <textarea [(ngModel)]="newPost.contenido" placeholder="¬øQu√© est√°s pensando? Comparte algo incre√≠ble...">
                </textarea>

                <!-- Secci√≥n de im√°genes (sub-acorde√≥n) -->
                <div class="image-section">
                    <div class="image-section-header" [class.expanded]="isImageSectionExpanded"
                        (click)="toggleImageSection()">
                        <span>üñºÔ∏è Agregar imagen</span>
                        <span class="accordion-icon">‚ñº</span>
                    </div>

                    <div class="image-section-content" [class.expanded]="isImageSectionExpanded">
                        <div class="mock-imagenes">
                            <img *ngFor="let img of mockImagenes" [src]="img" (click)="selectImage(img)"
                                [class.selected]="newPost.imagenUrl === img" class="miniatura" />
                        </div>
                    </div>
                </div>

                <button class="btn" (click)="publicarPost()">
                    üöÄ Publicar Post
                </button>
            </div>
        </div>

        <!-- Posts -->
        <div class="post-card" *ngFor="let post of posts">
            <div class="post-author">
                üë§ {{ post.autor.nombre }}
            </div>
            <div class="post-content">{{ post.contenido }}</div>

            <!-- Imagen clickeable -->
            <div class="post-image-container" *ngIf="post.imagenUrl">
                <img [src]="post.imagenUrl" alt="imagen del post" class="post-image"
                    (click)="abrirModal(post.imagenUrl, imgDialog)" />
            </div>

            <!-- Footer con fecha y stats -->
            <div class="post-footer">
                <div class="post-stats">
                    <!-- Bot√≥n de Like con √≠cono condicional -->
                    <button class="icon-btn" (click)="darLike(post)">
                        <span [ngClass]="post.usuarioHaDadoLike ? 'heart-liked' : 'heart-unliked'">
                            {{ post.usuarioHaDadoLike ? '‚ù§Ô∏è' : 'ü§ç' }}
                        </span>
                        {{ post.cantidadLikes }}
                    </button>

                    <!-- Bot√≥n de Comentarios -->
                    <button class="icon-btn" (click)="abrirComentarios(post)">
                        üí¨ {{ post.cantidadComentarios }}
                    </button>
                </div>
                <div>üìÖ {{ post.fechaIngreso | date:'short' }}</div>
            </div>
            <!-- Secci√≥n de Comentarios -->
                <div class="comentarios-container" *ngIf="post.mostrarComentarios">
                
                <div class="comentarios-lista">
                    <div *ngFor="let comentario of post.comentarios" class="comentario">
                    <div class="comentario-avatar">
                        <img src="../../assets/img/avatar-masculino.png" alt="Avatar" class="avatar">
                    </div>
                    <div class="comentario-contenido">
                        <div class="comentario-cabecera">
                        <span class="comentario-autor">{{ comentario.autor }}</span>
                        <span class="comentario-fecha">hace 2h</span>
                        </div>
                        <p class="comentario-texto">{{ comentario.texto }}</p>
                    </div>
                    </div>
                </div>

                <!-- Formulario para nuevo comentario -->
                <div class="nuevo-comentario">
                    <div class="nuevo-comentario-avatar">
                    <img src="assets/user-avatar.png" alt="Tu avatar" class="avatar">
                    </div>
                    <div class="nuevo-comentario-form">
                    <textarea 
                        [(ngModel)]="post.nuevoComentario" 
                        placeholder="Escribe un comentario..." 
                        class="comentario-input"
                        rows="2"></textarea>
                    <button 
                        (click)="agregarComentario(post)" 
                        class="comentario-boton"
                        [disabled]="!post.nuevoComentario">
                        <i class="fas fa-paper-plane"></i> Enviar
                    </button>
                    </div>
                </div>
                </div>

                </div>

        <!-- Modal global √∫nico para previsualizaci√≥n -->
        <dialog #imgDialog class="image-dialog">
            <img [src]="imagenSeleccionada" alt="Previsualizaci√≥n" class="modal-image" />
            <form method="dialog">
                <button class="close-btn">‚úï Cerrar</button>
            </form>
        </dialog>
    </div>