<div class="home-wrapper">
    <div class="feed-container">
        <h2>âœ¨ Mi Red Social</h2>

        <div class="post-form">
            <!-- Header del acordeÃ³n principal -->
            <div class="post-form-header" [class.expanded]="isPostFormExpanded" (click)="togglePostForm()">
                <span>ğŸ“ Crear nuevo post</span>
                <span class="accordion-icon">â–¼</span>
            </div>

            <!-- Contenido del acordeÃ³n principal -->
            <div class="post-form-content" [class.expanded]="isPostFormExpanded">
                <textarea [(ngModel)]="newPost.contenido" placeholder="Â¿QuÃ© estÃ¡s pensando? Comparte algo increÃ­ble...">
        </textarea>

                <!-- SecciÃ³n de imÃ¡genes (sub-acordeÃ³n) -->
                <div class="image-section">
                    <div class="image-section-header" [class.expanded]="isImageSectionExpanded"
                        (click)="toggleImageSection()">
                        <span>ğŸ–¼ï¸ Agregar imagen</span>
                        <span class="accordion-icon">â–¼</span>
                    </div>

                    <div class="image-section-content" [class.expanded]="isImageSectionExpanded">
                        <div class="mock-imagenes">
                            <img *ngFor="let img of mockImagenes" [src]="img" (click)="selectImage(img)"
                                [class.selected]="newPost.imagenUrl === img" class="miniatura" />
                        </div>
                    </div>
                </div>

                <button class="btn" (click)="publicarPost()">
                    ğŸš€ Publicar Post
                </button>
            </div>
        </div>

        <!-- Posts -->
        <div class="post-card" *ngFor="let post of posts">
            <div class="post-author">
                ğŸ‘¤ {{ post.autor.nombre }}
            </div>
            <div class="post-content">{{ post.contenido }}</div>

            <!-- Imagen clickeable -->
            <div class="post-image-container" *ngIf="post.imagenUrl">
                <img [src]="post.imagenUrl" alt="imagen del post" class="post-image"
                    (click)="abrirModal(post.imagenUrl, imgDialog)" />
            </div>

            <!-- Footer con fecha y stats -->
            <div class="post-footer">
                <div class="post-stats">
                    <!-- BotÃ³n de Like con Ã­cono condicional -->
                    <button class="icon-btn" (click)="darLike(post)">
                        <span [ngClass]="post.usuarioHaDadoLike ? 'heart-liked' : 'heart-unliked'">
                            {{ post.usuarioHaDadoLike ? 'â¤ï¸' : 'ğŸ¤' }}
                        </span>
                        {{ post.cantidadLikes }}
                    </button>

                    <!-- BotÃ³n de Comentarios -->
                    <button class="icon-btn" (click)="abrirComentarios(post)">
                        ğŸ’¬ {{ post.cantidadComentarios }}
                    </button>
                </div>
                <div>ğŸ“… {{ post.fechaIngreso | date:'short' }}</div>
            </div>
        </div>

        <!-- Modal global Ãºnico para previsualizaciÃ³n -->
        <dialog #imgDialog class="image-dialog">
            <img [src]="imagenSeleccionada" alt="PrevisualizaciÃ³n" class="modal-image" />
            <form method="dialog">
                <button class="close-btn">âœ• Cerrar</button>
            </form>
        </dialog>
    </div>